<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSM Dashboard</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <style>
        body {
            display: flex;
        }
        #sidebar {
            width: 250px;
            padding: 20px;
            border-right: 1px solid #ccc;
            height: 100vh;
        }
        #content {
            flex-grow: 1;
            padding: 20px;
        }
        .form-section {
            display: none;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <h4>Account Viewer</h4>
        <button class="btn btn-primary btn-block mb-2" onclick="viewAllAccounts()">View All Accounts</button>
        <button class="btn btn-secondary btn-block mb-2" onclick="showFindForm()">Find Account by ID</button>
        <button class="btn btn-warning btn-block mb-2" onclick="showUpdateForm()">Update Account by ID</button>
        <button class="btn btn-danger btn-block" onclick="showDeleteForm()">Delete Account by ID</button>
    </div>

    <div id="content">
        <div id="output"></div>

        <div id="findForm" class="form-section">
            <input type="number" id="findId" class="form-control" placeholder="Enter Account ID">
            <button class="btn btn-info mt-2" onclick="findAccount()">Find</button>
        </div>

        <div id="updateForm" class="form-section">
            <input type="number" id="updateId" class="form-control" placeholder="Account ID">
            <input type="text" id="updateName" class="form-control mt-2" placeholder="Account Name">
            <input type="text" id="updateWebsite" class="form-control mt-2" placeholder="Website">
            <input type="text" id="updateRevenue" class="form-control mt-2" placeholder="Revenue">
            <input type="text" id="updateRegion" class="form-control mt-2" placeholder="Region">
            <button class="btn btn-warning mt-2" onclick="updateAccount()">Update</button>
        </div>

        <div id="deleteForm" class="form-section">
            <input type="number" id="deleteId" class="form-control" placeholder="Enter Account ID">
            <button class="btn btn-danger mt-2" onclick="deleteAccount()">Delete</button>
        </div>
    </div>

    <script>
        function viewAllAccounts() {
            hideForms();
            $.get("/accounts", function(data) {
                let html = '<table class="table table-bordered"><thead><tr><th>ID</th><th>Name</th><th>Website</th><th>Revenue</th><th>Region</th></tr></thead><tbody>';
                data.forEach(a => {
                    html += `<tr><td>${a.id}</td><td>${a.name}</td><td>${a.website}</td><td>${a.revenue}</td><td>${a.region}</td></tr>`;
                });
                html += '</tbody></table>';
                $('#output').html(html);
            });
        }

        function showFindForm() {
            hideForms();
            $('#findForm').show();
        }

        function findAccount() {
            const id = $('#findId').val();
            $.get(`/accounts/${id}`, function(data) {
                let html = '<table class="table table-bordered"><thead><tr><th>ID</th><th>Name</th><th>Website</th><th>Revenue</th><th>Region</th></tr></thead>';
                html += `<tbody><tr><td>${data.id}</td><td>${data.name}</td><td>${data.website}</td><td>${data.revenue}</td><td>${data.region}</td></tr></tbody></table>`;
                $('#output').html(html);
            }).fail(() => {
                $('#output').html('<p class="text-danger">Account not found.</p>');
            });
        }

        function showUpdateForm() {
            hideForms();
            $('#updateForm').show();
        }

        function updateAccount() {
            const id = $('#updateId').val();
            const payload = {
                name: $('#updateName').val(),
                website: $('#updateWebsite').val(),
                revenue: $('#updateRevenue').val(),
                region: $('#updateRegion').val()
            };
            $.ajax({
                url: `/accounts/${id}`,
                method: "PUT",
                contentType: "application/json",
                data: JSON.stringify(payload),
                success: function(result) {
                    $('#output').html(`<p class='text-success'>Account updated: ${JSON.stringify(result)}</p>`);
                },
                error: function() {
                    $('#output').html('<p class="text-danger">Update failed.</p>');
                }
            });
        }

        function showDeleteForm() {
            hideForms();
            $('#deleteForm').show();
        }

        function deleteAccount() {
            const id = $('#deleteId').val();
            $.ajax({
                url: `/accounts/${id}`,
                method: "DELETE",
                success: function(result) {
                    $('#output').html(`<p class='text-success'>${result.message}</p>`);
                },
                error: function() {
                    $('#output').html('<p class="text-danger">Delete failed.</p>');
                }
            });
        }

        function hideForms() {
            $('.form-section').hide();
            $('#output').html('');
        }
    </script>
</body>
</html>
